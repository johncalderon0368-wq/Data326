<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠 Create Brain Server Package</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    🧠 Create Railway Brain Server Package
                </h1>
                <p class="text-gray-600">This will create a ZIP file with your AI brain server for Railway deployment</p>
            </div>

            <!-- Instructions -->
            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6 mb-8">
                <h2 class="text-lg font-bold text-purple-900 mb-3">🎯 How This Works:</h2>
                <ol class="text-purple-800 space-y-2">
                    <li><strong>1.</strong> Click "Create Brain Package" below</li>
                    <li><strong>2.</strong> Download the ZIP file to your computer</li>
                    <li><strong>3.</strong> Go to Railway.app → "New Project" → "Empty Project"</li>
                    <li><strong>4.</strong> Add new service and upload the ZIP file</li>
                    <li><strong>5.</strong> Railway will automatically detect Node.js and start your server!</li>
                </ol>
            </div>

            <!-- Create Package Button -->
            <div class="text-center mb-8">
                <button id="createBrainZip" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition-colors">
                    <i class="fas fa-brain mr-3"></i>
                    Create Brain Server Package
                </button>
            </div>

            <!-- Progress -->
            <div id="progress" class="hidden mb-8">
                <div class="bg-white rounded-lg p-6 border">
                    <div class="flex items-center mb-4">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600 mr-3"></div>
                        <span class="text-lg font-medium">Creating your brain server package...</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div id="progressText" class="text-sm text-gray-600 mt-2">Preparing server files...</div>
                </div>
            </div>

            <!-- Success -->
            <div id="success" class="hidden">
                <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                        <h3 class="text-lg font-bold text-green-900">Brain Server Package Created!</h3>
                    </div>
                    <p class="text-green-800 mb-4">Your AI brain server package has been created and should download automatically.</p>
                    
                    <div class="bg-white border border-green-200 rounded p-4 mb-4">
                        <h4 class="font-bold text-green-900 mb-2">🧠 Package Contents:</h4>
                        <ul id="packageContents" class="text-sm text-green-800 space-y-1">
                            <!-- Will be filled by JavaScript -->
                        </ul>
                    </div>

                    <div class="bg-purple-50 border border-purple-200 rounded p-4">
                        <h4 class="font-bold text-purple-900 mb-2">🚂 Railway Deployment Steps:</h4>
                        <ol class="text-purple-800 text-sm space-y-1">
                            <li><strong>1.</strong> Go to <a href="https://railway.app" target="_blank" class="underline">railway.app</a></li>
                            <li><strong>2.</strong> Login with GitHub</li>
                            <li><strong>3.</strong> Click "New Project" → "Empty Project"</li>
                            <li><strong>4.</strong> Click "New" → "Empty Service"</li>
                            <li><strong>5.</strong> Upload the downloaded ZIP file</li>
                            <li><strong>6.</strong> Railway auto-detects Node.js and starts your server! 🎉</li>
                            <li><strong>7.</strong> Get your server URL from Railway dashboard</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Alternative Method -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-8">
                <h3 class="text-lg font-bold text-yellow-900 mb-3">
                    <i class="fas fa-lightbulb mr-2"></i>
                    Alternative: Manual File Upload to Railway
                </h3>
                <p class="text-yellow-800 mb-3">If ZIP upload doesn't work, you can upload individual files:</p>
                <ol class="text-yellow-800 text-sm space-y-1">
                    <li><strong>1.</strong> On Railway, create empty service</li>
                    <li><strong>2.</strong> Upload these files from your project folder:</li>
                    <ul class="ml-4 mt-2 space-y-1">
                        <li>• <code>secure-dev-server.js</code> (main server file)</li>
                        <li>• <code>package.json</code> (dependencies)</li>
                        <li>• All files in <code>n8n-workflows/</code> folder</li>
                        <li>• All files in <code>config/</code> folder</li>
                    </ul>
                    <li><strong>3.</strong> Railway will auto-start your server</li>
                </ol>
            </div>

            <!-- What This Server Does -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-8">
                <h3 class="text-lg font-bold text-blue-900 mb-3">
                    <i class="fas fa-info-circle mr-2"></i>
                    What This Brain Server Does
                </h3>
                <div class="text-blue-800 text-sm space-y-2">
                    <p><strong>🎤 Voice Processing:</strong> Converts speech to text and text back to speech</p>
                    <p><strong>🤖 AI Responses:</strong> Generates intelligent responses using your workflows</p>
                    <p><strong>🔒 Security:</strong> Handles API keys securely server-side</p>
                    <p><strong>⚡ Performance:</strong> Optimized for fast response times</p>
                    <p><strong>🌐 API Endpoints:</strong> Provides REST API for your website to connect to</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('createBrainZip').addEventListener('click', createBrainPackage);

        async function createBrainPackage() {
            const button = document.getElementById('createBrainZip');
            const progress = document.getElementById('progress');
            const success = document.getElementById('success');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');

            button.disabled = true;
            button.classList.add('opacity-50');
            progress.classList.remove('hidden');

            try {
                const zip = new JSZip();
                let addedFiles = [];

                // Add main server file
                updateProgress(20, 'Adding main server file...');
                try {
                    const serverContent = await fetchFileContent('secure-dev-server.js');
                    if (serverContent) {
                        zip.file('secure-dev-server.js', serverContent);
                        addedFiles.push('✅ secure-dev-server.js (main server)');
                    }
                } catch (e) {
                    addedFiles.push('❌ secure-dev-server.js (not found)');
                }

                // Add package.json
                updateProgress(30, 'Adding package configuration...');
                try {
                    const packageContent = await fetchFileContent('package.json');
                    if (packageContent) {
                        zip.file('package.json', packageContent);
                        addedFiles.push('✅ package.json (dependencies)');
                    } else {
                        // Create a basic package.json if not found
                        const basicPackage = {
                            "name": "voice-agent-brain",
                            "version": "1.0.0",
                            "description": "AI Voice Agent Brain Server",
                            "main": "secure-dev-server.js",
                            "scripts": {
                                "start": "node secure-dev-server.js"
                            },
                            "engines": {
                                "node": ">=14.0.0"
                            }
                        };
                        zip.file('package.json', JSON.stringify(basicPackage, null, 2));
                        addedFiles.push('✅ package.json (created automatically)');
                    }
                } catch (e) {
                    addedFiles.push('❌ package.json (error creating)');
                }

                // Add workflows folder
                updateProgress(50, 'Adding n8n workflows...');
                const workflows = [
                    'jarvis-main-production-ready.json',
                    'content-creator-production-ready.json', 
                    'youtube-strategist-production-ready.json'
                ];

                let workflowsAdded = 0;
                for (const workflow of workflows) {
                    try {
                        const workflowContent = await fetchFileContent(`n8n-workflows/${workflow}`);
                        if (workflowContent) {
                            zip.folder('n8n-workflows').file(workflow, workflowContent);
                            workflowsAdded++;
                        }
                    } catch (e) {
                        console.log(`Workflow ${workflow} not found, skipping...`);
                    }
                }
                addedFiles.push(`✅ n8n-workflows/ (${workflowsAdded} workflow files)`);

                // Add config files
                updateProgress(70, 'Adding configuration files...');
                try {
                    const configContent = await fetchFileContent('config/n8n-integration.json');
                    if (configContent) {
                        zip.folder('config').file('n8n-integration.json', configContent);
                        addedFiles.push('✅ config/ (configuration files)');
                    }
                } catch (e) {
                    addedFiles.push('⚠️ config/ (optional files not found)');
                }

                // Add README for Railway
                updateProgress(80, 'Adding deployment instructions...');
                const readmeContent = `# Voice Agent Brain Server

## 🚀 Railway Deployment

This is your AI voice agent brain server. Railway will automatically:

1. Detect this as a Node.js project
2. Install dependencies from package.json  
3. Start the server using "npm start"
4. Provide a public URL for your server

## 🔧 Configuration

- Main server file: \`secure-dev-server.js\`
- Start command: \`node secure-dev-server.js\`
- Port: Automatically set by Railway (process.env.PORT)

## 📁 Files Included

- \`secure-dev-server.js\` - Main server application
- \`package.json\` - Dependencies and scripts
- \`n8n-workflows/\` - AI workflow definitions
- \`config/\` - Configuration files

## 🌐 Usage

Once deployed, your server will be available at:
https://your-project-name.up.railway.app

Connect your website to this URL to enable full AI functionality!
`;

                zip.file('README.md', readmeContent);
                addedFiles.push('✅ README.md (deployment guide)');

                // Generate ZIP
                updateProgress(90, 'Creating ZIP package...');
                const content = await zip.generateAsync({type: 'blob'});

                // Download
                updateProgress(100, 'Download starting...');
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'voice-agent-brain-railway.zip';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                // Show success
                setTimeout(() => {
                    progress.classList.add('hidden');
                    success.classList.remove('hidden');
                    
                    // Show package contents
                    const contentsList = document.getElementById('packageContents');
                    contentsList.innerHTML = addedFiles.map(file => `<li>${file}</li>`).join('');
                }, 1000);

            } catch (error) {
                console.error('Error creating brain package:', error);
                alert('Error creating package. Please try the manual method below.');
            }

            button.disabled = false;
            button.classList.remove('opacity-50');
        }

        async function fetchFileContent(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) throw new Error(`File not found: ${path}`);
                return await response.text();
            } catch (error) {
                console.warn(`Could not fetch ${path}:`, error);
                return null;
            }
        }

        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
    </script>
</body>
</html>